# MUI to Modus Migration Tool

## Purpose
Transform Material-UI (MUI) v7 components to Modus V2 web components based on the analysis report generated by `analyze_mui.md`. This tool performs the actual code transformation while preserving functionality and adapting to Modus patterns.

## Data Sources
- **Analysis Report**: The `.mui-analysis.md` file from the analyze phase
- `mui_to_modus_mapping.json`: Component mapping reference
- `mui_v7_components.json`: MUI component specifications
- `v2_components.json`: Modus V2 web component specifications
- `v2_react_framework_data.json`: React integration patterns for Modus web components
- `v2_angular_framework_data.json`: Angular integration patterns (if applicable)

## Migration Strategy

### 1. Import Transformation
- **Remove MUI imports**: Remove all `@mui/material` and `@mui/icons-material` imports
- **Add Modus imports**: 
  ```javascript
  // For React
  import { defineCustomElements } from '@trimble-oss/modus-web-components/loader';
  
  // Call once in app initialization
  defineCustomElements();
  ```

### 2. Component Transformation Rules

#### Basic Components
- **MUI Component** → **Modus Web Component**
- Apply property mappings from analysis report
- Transform event handlers to Modus format

#### Complex Patterns

**Icons**:
- MUI: `<IconButton><DeleteIcon /></IconButton>`
- Modus: `<modus-wc-button shape="circle"><modus-wc-icon name="delete"></modus-wc-icon></modus-wc-button>`

**Forms**:
- MUI TextField with label/helper:
  ```jsx
  <TextField label="Name" helperText="Enter your name" error={hasError} />
  ```
- Modus structure:
  ```jsx
  <div className="form-group">
    <modus-wc-input-label for="name-input">Name</modus-wc-input-label>
    <modus-wc-text-input id="name-input" invalid={hasError}></modus-wc-text-input>
    <modus-wc-input-feedback type={hasError ? "invalid" : "valid"}>
      Enter your name
    </modus-wc-input-feedback>
  </div>
  ```

**Layout Components**:
- Replace MUI Grid/Box/Stack with CSS Grid/Flexbox
- Convert sx prop to className with appropriate CSS

### 3. Property Mapping Examples

| MUI Prop | Modus Prop | Transformation |
|----------|------------|----------------|
| `variant="contained"` | `variant="filled"` | Direct map |
| `color="error"` | `color="danger"` | Value map |
| `size="small"` | `size="sm"` | Value transform |
| `sx={{...}}` | `className="..."` | Convert to CSS |
| `startIcon={<Icon />}` | Nested `<modus-wc-icon>` | Structural change |

### 4. Event Handler Transformation

**React Example**:
```jsx
// MUI
<Button onClick={handleClick}>Click</Button>

// Modus in React
<modus-wc-button 
  ref={buttonRef}
  onButtonClick={handleClick}  // or use ref with addEventListener
>Click</modus-wc-button>
```

### 5. Theme Migration
- Convert MUI theme tokens to CSS variables
- Map MUI theme colors to Modus design tokens
- Replace styled-components with CSS classes

## Migration Process

1. **Parse Source File**: Read the original file and its analysis report
2. **Transform Imports**: Update import statements
3. **Component Migration**:
   - For each identified MUI component:
     - Replace with Modus equivalent
     - Transform properties
     - Restructure if needed (forms, icons)
     - Update event handlers
4. **Style Migration**:
   - Convert sx props to CSS
   - Update theme references
5. **Generate Output**:
   - Save as `[original_filename].migrated.[ext]`
   - Preserve original file

## Special Considerations

### No Direct Mapping Components
For components listed in `no_direct_mapping`:
- Add comment: `// TODO: No direct Modus equivalent for MUI [Component]`
- Suggest alternatives or custom implementation
- Common patterns:
  - Grid → CSS Grid
  - Box → div with styles
  - Typography → HTML elements with Modus typography classes

### Framework-Specific Handling

**React**:
- Ensure proper web component integration
- Handle synthetic events vs native events
- Consider using refs for complex interactions

**Angular**:
- Add CUSTOM_ELEMENTS_SCHEMA
- Use proper binding syntax for web components
- Handle event emitters appropriately

## Output Format

The migrated file should:
1. Maintain the same functionality as the original
2. Use Modus V2 web components correctly
3. Include TODO comments for manual review items
4. Preserve code structure and formatting where possible

## Migration Log
Generate a `migration.log` documenting:
- Components successfully migrated
- Properties transformed
- Manual interventions required
- Warnings or potential issues
- Components skipped (no mapping)

Example log entry:
```
[SUCCESS] Button @ line 45 → modus-wc-button
  - Transformed: variant="contained" → variant="filled"
  - Event: onClick → onButtonClick
[WARNING] Grid @ line 60 → No direct mapping
  - Suggested: Use CSS Grid layout
[MANUAL] TextField @ line 75 → modus-wc-text-input
  - Requires structural change for label/helper text
```
